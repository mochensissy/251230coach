# æ³¨å†Œå’Œè®¤è¯ç³»ç»Ÿå®ç°æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬é¡¹ç›®å·²å®ç°å®Œæ•´çš„æ³¨å†Œç™»å½•ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

1. âœ… åŸºäºæ¿€æ´»ç çš„ç”¨æˆ·æ³¨å†Œ
2. âœ… ç”¨æˆ·ç™»å½•è®¤è¯
3. âœ… ç®¡ç†å‘˜åå°ç³»ç»Ÿ
4. âœ… æ¿€æ´»ç ç®¡ç†åŠŸèƒ½
5. âœ… DeepSeek API é…ç½®ç®¡ç†
6. âœ… ç®¡ç†å‘˜çœ‹æ¿ç»Ÿè®¡

## ğŸ”‘ æ³¨å†Œæµç¨‹

### ç”¨æˆ·æ³¨å†Œ
1. ç”¨æˆ·è®¿é—® `/register` æ³¨å†Œé¡µé¢
2. å¡«å†™ï¼šç”¨æˆ·åã€å¯†ç ã€ç¡®è®¤å¯†ç ã€æ¿€æ´»ç 
3. ç³»ç»ŸéªŒè¯ï¼š
   - ç”¨æˆ·åå”¯ä¸€æ€§ï¼ˆè‡³å°‘3ä¸ªå­—ç¬¦ï¼‰
   - å¯†ç å¼ºåº¦ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰
   - æ¿€æ´»ç æœ‰æ•ˆæ€§ï¼ˆæœªä½¿ç”¨ã€æœªè¿‡æœŸï¼‰
4. æ³¨å†ŒæˆåŠŸåè·³è½¬åˆ°ç”¨æˆ·ç”»åƒé‡‡é›†é¡µé¢

### ç”¨æˆ·ç™»å½•
1. ç”¨æˆ·è®¿é—® `/login` ç™»å½•é¡µé¢
2. å¡«å†™ç”¨æˆ·åå’Œå¯†ç 
3. ç™»å½•æˆåŠŸåï¼š
   - æ™®é€šç”¨æˆ·ï¼šè·³è½¬åˆ° Dashboard æˆ– Onboarding
   - ç®¡ç†å‘˜ç”¨æˆ·ï¼šè·³è½¬åˆ°ç®¡ç†å‘˜åå°

## ğŸ›¡ï¸ ç®¡ç†å‘˜ç³»ç»Ÿ

### åˆ›å»ºåˆå§‹ç®¡ç†å‘˜

**é‡è¦**ï¼šé¦–æ¬¡éƒ¨ç½²åéœ€è¦æ‰‹åŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦å·ã€‚

#### æ–¹æ³• 1ï¼šä½¿ç”¨ Prisma Studioï¼ˆæ¨èï¼‰

```bash
# æœ¬åœ°å¼€å‘
npx prisma studio

# ç„¶ååœ¨æµè§ˆå™¨ä¸­ï¼š
# 1. æ‰“å¼€ users è¡¨
# 2. åˆ›å»ºæ–°ç”¨æˆ·
# 3. è®¾ç½®å­—æ®µï¼š
#    - username: admin
#    - password: 8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918 (å¯†ç : adminï¼Œsha256å“ˆå¸Œ)
#    - isAdmin: true
#    - onboardingCompleted: true
```

#### æ–¹æ³• 2ï¼šç›´æ¥æ‰§è¡Œ SQL

```sql
INSERT INTO users (username, password, isAdmin, onboardingCompleted, createdAt, updatedAt)
VALUES (
  'admin',
  '8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918',
  true,
  true,
  datetime('now'),
  datetime('now')
);
```

**é»˜è®¤ç®¡ç†å‘˜è´¦å·**ï¼š
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin`ï¼ˆ**éƒ¨ç½²åè¯·ç«‹å³ä¿®æ”¹**ï¼‰

### ç®¡ç†å‘˜åŠŸèƒ½

#### 1. ç®¡ç†å‘˜çœ‹æ¿ (`/admin`)
- æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡æ•°æ®
- æ€»ç”¨æˆ·æ•°ã€æ€»ä¼šè¯æ•°
- æ¿€æ´»ç ä½¿ç”¨æƒ…å†µ
- æœ€è¿‘æ³¨å†Œç”¨æˆ·åˆ—è¡¨
- æœ€è¿‘ä¼šè¯åˆ—è¡¨

#### 2. æ¿€æ´»ç ç®¡ç† (`/admin/activation-codes`)
- **ç”Ÿæˆæ¿€æ´»ç **
  - æ‰¹é‡ç”Ÿæˆï¼ˆ1-100ä¸ªï¼‰
  - è®¾ç½®å¤‡æ³¨è¯´æ˜
  - è®¾ç½®æœ‰æ•ˆæœŸï¼ˆå¯é€‰ï¼‰
- **æŸ¥çœ‹æ¿€æ´»ç åˆ—è¡¨**
  - æ¿€æ´»ç ã€çŠ¶æ€ã€ä½¿ç”¨è€…
  - å¤‡æ³¨ã€åˆ›å»ºæ—¶é—´
  - å¤åˆ¶æ¿€æ´»ç åŠŸèƒ½
- **åˆ é™¤æ¿€æ´»ç **
  - ä»…èƒ½åˆ é™¤æœªä½¿ç”¨çš„æ¿€æ´»ç 

#### 3. API é…ç½®ç®¡ç† (`/admin/settings`)
- é…ç½® DeepSeek API Key
- æ‰€æœ‰ç”¨æˆ·å¯¹è¯å°†ä½¿ç”¨é…ç½®çš„ API
- æ”¯æŒå®æ—¶æ›´æ–°ï¼Œæ— éœ€é‡å¯

## ğŸ”Œ API æ¥å£

### è®¤è¯ç›¸å…³

#### POST `/api/auth/register`
ç”¨æˆ·æ³¨å†Œ

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "testuser",
  "password": "password123",
  "activationCode": "ABC123DEF456"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "user": {
    "id": 1,
    "username": "testuser",
    "isAdmin": false
  },
  "token": "base64_encoded_token"
}
```

#### POST `/api/auth/login`
ç”¨æˆ·ç™»å½•

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "testuser",
  "password": "password123"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "user": {
    "id": 1,
    "username": "testuser",
    "isAdmin": false,
    "onboardingCompleted": true
  },
  "token": "base64_encoded_token"
}
```

### ç®¡ç†å‘˜æ¥å£

#### GET `/api/admin/dashboard?admin=username`
è·å–ç®¡ç†å‘˜çœ‹æ¿æ•°æ®

**å“åº”**ï¼š
```json
{
  "stats": {
    "totalUsers": 10,
    "totalSessions": 25,
    "totalActivationCodes": 20,
    "usedActivationCodes": 10,
    "unusedActivationCodes": 10
  },
  "recentUsers": [...],
  "recentSessions": [...]
}
```

#### GET `/api/admin/activation-codes?admin=username`
è·å–æ¿€æ´»ç åˆ—è¡¨

#### POST `/api/admin/activation-codes`
ç”Ÿæˆæ¿€æ´»ç 

**è¯·æ±‚ä½“**ï¼š
```json
{
  "adminUsername": "admin",
  "count": 5,
  "note": "é”€å”®éƒ¨é—¨",
  "expiresInDays": 30
}
```

#### DELETE `/api/admin/activation-codes?admin=username&id=1`
åˆ é™¤æ¿€æ´»ç 

#### GET `/api/admin/settings?admin=username`
è·å– API é…ç½®

#### POST `/api/admin/settings`
æ›´æ–° API é…ç½®

**è¯·æ±‚ä½“**ï¼š
```json
{
  "adminUsername": "admin",
  "deepseekApiKey": "sk-..."
}
```

## ğŸ—„ï¸ æ•°æ®åº“å˜æ›´

### æ–°å¢è¡¨

#### `activation_codes` - æ¿€æ´»ç è¡¨
- `id`: ä¸»é”®
- `code`: æ¿€æ´»ç ï¼ˆå”¯ä¸€ï¼‰
- `isUsed`: æ˜¯å¦å·²ä½¿ç”¨
- `usedBy`: ä½¿ç”¨è€…ID
- `createdBy`: åˆ›å»ºè€…ï¼ˆç®¡ç†å‘˜ç”¨æˆ·åï¼‰
- `note`: å¤‡æ³¨
- `expiresAt`: è¿‡æœŸæ—¶é—´
- `usedAt`: ä½¿ç”¨æ—¶é—´
- `createdAt`: åˆ›å»ºæ—¶é—´

#### `admin_logs` - ç®¡ç†å‘˜æ“ä½œæ—¥å¿—è¡¨
- `id`: ä¸»é”®
- `adminName`: ç®¡ç†å‘˜ç”¨æˆ·å
- `action`: æ“ä½œç±»å‹
- `details`: æ“ä½œè¯¦æƒ…ï¼ˆJSONï¼‰
- `createdAt`: æ“ä½œæ—¶é—´

### ä¿®æ”¹è¡¨

#### `users` è¡¨å¢åŠ å­—æ®µ
- `password`: å¯†ç å“ˆå¸Œï¼ˆSHA256ï¼‰
- `isAdmin`: æ˜¯å¦ä¸ºç®¡ç†å‘˜
- `activationCodeId`: å…³è”çš„æ¿€æ´»ç ID

#### `settings` è¡¨
ç”¨äºå­˜å‚¨ç³»ç»Ÿé…ç½®ï¼Œç‰¹åˆ«æ˜¯ `deepseek_api_key`

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ•°æ®åº“è¿ç§»

```bash
# ç”Ÿæˆ Prisma Client
npx prisma generate

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
npx prisma migrate deploy
# æˆ–ä½¿ç”¨ db pushï¼ˆå¼€å‘ç¯å¢ƒï¼‰
npx prisma db push
```

### 2. åˆ›å»ºç®¡ç†å‘˜è´¦å·

ä½¿ç”¨ä¸Šè¿°æ–¹æ³•åˆ›å»ºåˆå§‹ç®¡ç†å‘˜è´¦å·

### 3. é…ç½® DeepSeek API

1. ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•
2. è¿›å…¥"API é…ç½®"é¡µé¢
3. è¾“å…¥ DeepSeek API Key
4. ä¿å­˜é…ç½®

### 4. ç”Ÿæˆæ¿€æ´»ç 

1. è¿›å…¥"æ¿€æ´»ç ç®¡ç†"é¡µé¢
2. ç‚¹å‡»"ç”Ÿæˆæ¿€æ´»ç "
3. è®¾ç½®æ•°é‡å’Œå¤‡æ³¨
4. å¤åˆ¶æ¿€æ´»ç åˆ†å‘ç»™ç”¨æˆ·

## ğŸ”’ å®‰å…¨è¯´æ˜

### å¯†ç å®‰å…¨
- å¯†ç ä½¿ç”¨ SHA256 å“ˆå¸Œå­˜å‚¨
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ bcrypt æˆ– argon2
- å»ºè®®å®ç°å¯†ç å¤æ‚åº¦ç­–ç•¥

### Token ç®¡ç†
- å½“å‰ä½¿ç”¨ç®€å•çš„ Base64 ç¼–ç 
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ JWT
- å»ºè®®å®ç° Token è¿‡æœŸæœºåˆ¶

### API å®‰å…¨
- ç®¡ç†å‘˜æ¥å£ä½¿ç”¨ç”¨æˆ·åéªŒè¯
- å»ºè®®å®ç°æ›´ä¸¥æ ¼çš„è®¤è¯ä¸­é—´ä»¶
- å»ºè®®æ·»åŠ  CSRF ä¿æŠ¤

## ğŸ“ ä½¿ç”¨æµç¨‹

### å…¸å‹ç”¨æˆ·æµç¨‹

1. **ç®¡ç†å‘˜å‡†å¤‡**
   ```
   ç®¡ç†å‘˜ç™»å½• â†’ é…ç½® API â†’ ç”Ÿæˆæ¿€æ´»ç  â†’ åˆ†å‘ç»™ç”¨æˆ·
   ```

2. **ç”¨æˆ·æ³¨å†Œ**
   ```
   è®¿é—®æ³¨å†Œé¡µ â†’ å¡«å†™ä¿¡æ¯ â†’ è¾“å…¥æ¿€æ´»ç  â†’ æ³¨å†ŒæˆåŠŸ â†’ å®Œæˆç”»åƒé‡‡é›†
   ```

3. **ç”¨æˆ·ä½¿ç”¨**
   ```
   ç™»å½• â†’ é€‰æ‹©åœºæ™¯ â†’ å¼€å§‹å¯¹è¯ â†’ ç”ŸæˆæŠ¥å‘Š
   ```

### ç®¡ç†å‘˜æ—¥å¸¸å·¥ä½œ

1. **æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€**
   - æ¯å¤©æŸ¥çœ‹ç®¡ç†å‘˜çœ‹æ¿
   - ç›‘æ§ç”¨æˆ·æ³¨å†Œæƒ…å†µ
   - æ£€æŸ¥ä¼šè¯ä½¿ç”¨æƒ…å†µ

2. **ç®¡ç†æ¿€æ´»ç **
   - æ ¹æ®éœ€æ±‚ç”Ÿæˆæ–°æ¿€æ´»ç 
   - æŸ¥çœ‹æ¿€æ´»ç ä½¿ç”¨æƒ…å†µ
   - æ¸…ç†è¿‡æœŸæ¿€æ´»ç 

3. **ç»´æŠ¤ API é…ç½®**
   - ç›‘æ§ API ä½¿ç”¨é¢åº¦
   - å¿…è¦æ—¶æ›´æ–° API Key

## ğŸ› æ•…éšœæ’æŸ¥

### æ³¨å†Œå¤±è´¥

**é—®é¢˜**ï¼šæç¤º"æ¿€æ´»ç ä¸å­˜åœ¨"
- æ£€æŸ¥æ¿€æ´»ç æ˜¯å¦æ­£ç¡®ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰
- ç¡®è®¤æ¿€æ´»ç æœªè¢«ä½¿ç”¨
- æ£€æŸ¥æ¿€æ´»ç æ˜¯å¦è¿‡æœŸ

**é—®é¢˜**ï¼šæç¤º"ç”¨æˆ·åå·²å­˜åœ¨"
- å°è¯•ä½¿ç”¨å…¶ä»–ç”¨æˆ·å

### ç™»å½•å¤±è´¥

**é—®é¢˜**ï¼šæç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
- ç¡®è®¤ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®
- æ£€æŸ¥æ˜¯å¦å·²å®Œæˆæ³¨å†Œ

### å¯¹è¯å¤±è´¥

**é—®é¢˜**ï¼šæç¤º"DeepSeek API æœªé…ç½®"
- ç®¡ç†å‘˜éœ€è¦åœ¨åå°é…ç½® API Key
- æ£€æŸ¥ API Key æ˜¯å¦æœ‰æ•ˆ
- ç¡®è®¤ API æœ‰è¶³å¤Ÿé¢åº¦

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
3. è”ç³»æŠ€æœ¯å›¢é˜Ÿ

---

**å®‰å…¨æé†’**ï¼š
- éƒ¨ç½²åç«‹å³ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
- å®šæœŸæ£€æŸ¥ç®¡ç†å‘˜æ“ä½œæ—¥å¿—
- å¦¥å–„ä¿ç®¡æ¿€æ´»ç 
- ä¸è¦å°† API Key æ³„éœ²

**æœ€ä½³å®è·µ**ï¼š
- ä¸ºä¸åŒéƒ¨é—¨ç”Ÿæˆå¸¦å¤‡æ³¨çš„æ¿€æ´»ç 
- è®¾ç½®åˆç†çš„æ¿€æ´»ç æœ‰æ•ˆæœŸ
- å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„è¿‡æœŸæ¿€æ´»ç 
- ç›‘æ§ API ä½¿ç”¨æƒ…å†µï¼Œé¿å…è¶…å‡ºé¢åº¦

