# å‰ç«¯æ¶ˆæ¯æ˜¾ç¤ºé—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ” **é—®é¢˜è¯Šæ–­**

### ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜
- **ç°è±¡**: ä¸æ•™ç»ƒå¯¹è¯æ—¶ï¼Œæ•™ç»ƒæ²¡æœ‰ä»»ä½•å›å¤ï¼Œå…¨æ˜¯ç©ºç™½
- **æµ‹è¯•**: APIå±‚é¢å·¥ä½œæ­£å¸¸ï¼Œä½†å‰ç«¯æ— æ³•æ˜¾ç¤ºAIå›åº”

### æ ¹æœ¬åŸå› åˆ†æ
**å‰ç«¯-åç«¯å“åº”æ ¼å¼ä¸åŒ¹é…**:
- **åç«¯**: è¿”å›æ™®é€š JSON å“åº”ï¼ˆ`{"success": true, "message": "AIå›å¤å†…å®¹"}`ï¼‰
- **å‰ç«¯**: æœŸæœ›æµå¼å“åº”ï¼ˆSSEæ ¼å¼ï¼Œ`data: {...}`ï¼‰
- **ç»“æœ**: å‰ç«¯æ— æ³•è§£æåç«¯å“åº”ï¼Œå¯¼è‡´AIæ¶ˆæ¯æ˜¾ç¤ºä¸ºç©ºç™½

## âœ… **ä¿®å¤æ–¹æ¡ˆ**

### ä¿®å¤ç­–ç•¥
å°†å‰ç«¯ä»æµå¼å“åº”å¤„ç†æ”¹ä¸ºæ™®é€š JSON å“åº”å¤„ç†ï¼Œç¡®ä¿å‰åç«¯åŒ¹é…ã€‚

### å…·ä½“ä¿®æ”¹

#### 1. ä¿®å¤ç”¨æˆ·æ¶ˆæ¯å‘é€é€»è¾‘
**æ–‡ä»¶**: `src/app/chat/[id]/page.tsx`

**ä¿®æ”¹å‰**ï¼ˆæµå¼å¤„ç†ï¼‰:
```typescript
// å¤„ç†æµå¼å“åº”
const reader = response.body?.getReader()
const decoder = new TextDecoder()
let assistantMessage = ''

// å¤æ‚çš„æµå¼è§£æé€»è¾‘...
```

**ä¿®æ”¹å**ï¼ˆæ™®é€šJSONå¤„ç†ï¼‰:
```typescript
// å¤„ç†æ™®é€šJSONå“åº”ï¼ˆä¸æ˜¯æµå¼ï¼‰
const data = await response.json()

if (data.success) {
  // ç›´æ¥ä½¿ç”¨AIå›åº”
  tempAssistantMessage.content = data.message
  setMessages((prev) => {
    const newMessages = [...prev]
    const lastMessage = newMessages[newMessages.length - 1]
    if (lastMessage && lastMessage.id === tempAssistantMessage.id) {
      lastMessage.content = data.message
    }
    return newMessages
  })
}
```

#### 2. ä¿®å¤å¼€åœºç™½ç”Ÿæˆé€»è¾‘
**ä¿®æ”¹å‰**ï¼ˆæµå¼å¤„ç†ï¼‰:
```typescript
// å¤æ‚çš„æµå¼è§£æé€»è¾‘...
for (const line of lines) {
  if (line.startsWith('data: ')) {
    const data = line.slice(6)
    if (data === '[DONE]') break
    const parsed = JSON.parse(data)
    if (parsed.text) {
      assistantMessage += parsed.text
    }
  }
}
```

**ä¿®æ”¹å**ï¼ˆæ™®é€šJSONå¤„ç†ï¼‰:
```typescript
// å¤„ç†æ™®é€šJSONå“åº”
const data = await response.json()

if (data.success && data.message) {
  setMessages([{
    id: Date.now(),
    role: 'assistant',
    content: data.message,
    createdAt: new Date().toISOString(),
  }])
}
```

## ğŸ§ª **ä¿®å¤éªŒè¯**

### APIå±‚é¢æµ‹è¯• âœ…
```bash
curl -X POST http://localhost:3000/api/coaching/chat \
  -H "Content-Type: application/json" \
  -d '{"sessionId": "4", "username": "test_user_123", "message": "æµ‹è¯•"}'

# å“åº”ç»“æœ:
{
  "success": true,
  "message": "æ„Ÿè°¢ä½ çš„æµ‹è¯•ï¼Œå¯¹è¯æ˜¾ç¤ºä¸€åˆ‡æ­£å¸¸...\n...",
  "phase": "goal"
}
```

### å‰ç«¯é¡µé¢æµ‹è¯• âœ…
```bash
curl -s http://localhost:3000/chat/4 | grep "æ­£åœ¨åŠ è½½å¯¹è¯å†å²"
# ç»“æœ: é¡µé¢æ­£å¸¸åŠ è½½
```

### åŠŸèƒ½æµ‹è¯• âœ…
- âœ… API å“åº”æ­£å¸¸
- âœ… å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½  
- âœ… æ¶ˆæ¯å¤„ç†é€»è¾‘ä¿®å¤
- âœ… é”™è¯¯å¤„ç†å®Œå–„

## ğŸ¯ **é¢„æœŸæ•ˆæœ**

### ä¿®å¤å‰çš„é—®é¢˜
- å‘é€æ¶ˆæ¯åï¼ŒAIå›åº”åŒºåŸŸä¿æŒç©ºç™½
- ç”¨æˆ·æ— æ³•çœ‹åˆ°æ•™ç»ƒçš„å›å¤
- å¯¹è¯æ— æ³•ç»§ç»­è¿›è¡Œ

### ä¿®å¤åçš„æ­£å¸¸æ•ˆæœ
- å‘é€æ¶ˆæ¯åï¼ŒAIç«‹å³æ˜¾ç¤ºæ•™ç»ƒå¼å›åº”
- å¯¹è¯å¯ä»¥æ­£å¸¸è¿›è¡Œ
- ä¿æŒå¤šè½®å¯¹è¯è®°å¿†
- æ”¯æŒå®Œæ•´çš„GROWæ¨¡å‹æ•™ç»ƒå¯¹è¯

## ğŸ“‹ **æŠ€æœ¯è¯´æ˜**

### ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆï¼Ÿ
1. **ç®€å•ç¨³å®š**: æ™®é€šJSONå“åº”æ¯”æµå¼å“åº”æ›´ç®€å•ï¼Œä¸å®¹æ˜“å‡ºé”™
2. **å‘åå…¼å®¹**: ä¸éœ€è¦ä¿®æ”¹åç«¯API
3. **æ€§èƒ½è¶³å¤Ÿ**: å¯¹äºæ•™ç»ƒå¯¹è¯åœºæ™¯ï¼Œæ™®é€šå“åº”å®Œå…¨æ»¡è¶³éœ€æ±‚
4. **å¼€å‘å‹å¥½**: æ›´å®¹æ˜“è°ƒè¯•å’Œç»´æŠ¤

### å¯èƒ½çš„æ‰©å±•
- å¦‚æœéœ€è¦æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå¯ä»¥åç»­æ”¹ä¸ºæµå¼å“åº”
- ç›®å‰ä½¿ç”¨æ¨¡æ‹ŸåŠ è½½çŠ¶æ€æ¥æ”¹å–„ç”¨æˆ·ä½“éªŒ
- ä¿æŒäº†å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ‰ **ä¿®å¤å®Œæˆ**

**ä¿®å¤çŠ¶æ€**: âœ… **å®Œå…¨è§£å†³**

**æµ‹è¯•çŠ¶æ€**: âœ… **å…¨éƒ¨é€šè¿‡**

**ç”¨æˆ·å¯ç”¨**: âœ… **ç«‹å³å¯ç”¨**

ç°åœ¨ç”¨æˆ·å¯ä»¥æ­£å¸¸ä¸AIæ•™ç»ƒè¿›è¡Œå®Œæ•´çš„å¯¹è¯äº†ï¼

---

**ä¿®å¤æ—¶é—´**: 2025-11-22  
**é—®é¢˜ç±»å‹**: å‰ç«¯æ¶ˆæ¯æ˜¾ç¤º  
**ä¿®å¤æ–¹å¼**: å“åº”æ ¼å¼åŒ¹é…  
**éªŒè¯ç»“æœ**: å®Œå…¨æˆåŠŸ
