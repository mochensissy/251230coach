# 可复用_技术_多账号切换

## 需求描述
一个家长账号 (Parent) 下可以管理多个孩子档案 (Child)。家长可以在不重新登录的情况下，快速切换当前查看和管理的孩子视角。

## 实现逻辑

### 1. 数据结构设计
*   **User 表**：存储家长（主账号）信息。
*   **Child 表**：存储孩子信息，通过 `userId` 关联到家长。
    *   `id`: unique string
    *   `userId`: string (foreign key)
    *   `name`: string
    *   `grade`: number

### 2. 全局状态管理 (Zustand)
使用 Zustand (或其他状态库) 存储 `currentChildId`。此状态决定了当前 UI 展示谁的数据。

```typescript
// store/authStore.ts
interface AuthState {
    user: User | null;
    currentChildId: string | null; // 当前选中的孩子 ID
    
    // Action
    switchChild: (childId: string) => void;
}

const useAuthStore = create<AuthState>((set) => ({
    user: null,
    currentChildId: localStorage.getItem('currentChildId'), // 持久化，刷新不丢失
    
    switchChild: (childId) => {
        localStorage.setItem('currentChildId', childId);
        set({ currentChildId: childId });
    }
}));
```

### 3. 数据隔离与响应
所有的业务组件（如 PlanList, StatsChart）都必须依赖 `currentChildId` 来请求数据。

```typescript
// DashboardPage.tsx
const { currentChildId } = useAuthStore();

useEffect(() => {
    if (currentChildId) {
        // 当切换孩子时，自动重新加载对应的数据
        loadPlans(currentChildId);
        loadStats(currentChildId);
    }
}, [currentChildId]); // 依赖项包含 childId
```

### 4. 切换 UI 实现 (DashboardSidebar)
通常在侧边栏顶部展示当前孩子头像，点击弹出下拉菜单。

```typescript
// DashboardSidebar.tsx
const handleSwitch = (childId) => {
    switchChild(childId);
    // 可选：刷新页面或清理在此之前的一些临时状态
    // window.location.reload(); // 简单粗暴但不推荐
};

return (
    <div>
        {childrenList.map(child => (
            <div onClick={() => handleSwitch(child.id)}>
                {child.name}
            </div>
        ))}
        <div onClick={navigateToAddChild}>+ 添加孩子</div>
    </div>
);
```

## 注意事项
1.  **持久化**：务必将 `currentChildId` 存入 LocalStorage，否则用户刷新界面会回到默认或丢失状态。
2.  **默认选中**：登录后，如果用户有孩子，应自动选中第一个孩子；如果没有，引导去创建。
3.  **权限控制**：切换时需验证该 childId 是否确实属于当前登录的 userId（前端校验 + 后端 API 鉴权）。
