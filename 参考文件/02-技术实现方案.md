# æŠ€æœ¯å®ç°æ–¹æ¡ˆ

## ä¸€ã€é¡¹ç›®ç»“æ„

```
study-checkin-platform/
â”‚
â”œâ”€â”€ client/                          # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”‚   â”œâ”€â”€ manifest.json            # PWAé…ç½®
â”‚   â”‚   â””â”€â”€ icons/                   # PWAå›¾æ ‡
â”‚   â”‚
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx                 # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ App.tsx                  # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ index.css                # å…¨å±€æ ·å¼
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ components/              # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                  # shadcn/uiç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ slider.tsx       # æ—¶é—´æ»‘å—
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/              # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BottomNav.tsx    # ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆª
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MainLayout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ common/              # ä¸šåŠ¡é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Timer.tsx        # è®¡æ—¶å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SyncButton.tsx   # åŒæ­¥æŒ‰é’®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SubjectIcon.tsx  # ç§‘ç›®å›¾æ ‡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ StatCard.tsx     # ç»Ÿè®¡å¡ç‰‡
â”‚   â”‚   â”‚   â””â”€â”€ charts/              # å›¾è¡¨ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ CompletionChart.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ TimeDistributionChart.tsx
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ pages/                   # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/                # è®¤è¯ç›¸å…³
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterPage.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SelectChildPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ child/               # å°å­©æ¨¡å¼é¡µé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx      # ä¸»çœ‹æ¿
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PlanPage.tsx           # å­¦ä¹ è®¡åˆ’
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ StatsPage.tsx          # ç»Ÿè®¡åˆ†æ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AchievementsPage.tsx   # å‹‹ç« å¢™
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RewardsPage.tsx        # å¥–åŠ±å…‘æ¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ScoresPage.tsx         # æˆç»©æŸ¥çœ‹
â”‚   â”‚   â”‚   â””â”€â”€ parent/              # å®¶é•¿æ¨¡å¼é¡µé¢
â”‚   â”‚   â”‚       â”œâ”€â”€ ParentDashboard.tsx    # å®¶é•¿çœ‹æ¿
â”‚   â”‚   â”‚       â”œâ”€â”€ ChildrenManage.tsx     # å°å­©ç®¡ç†
â”‚   â”‚   â”‚       â”œâ”€â”€ AchievementSettings.tsx # å‹‹ç« è®¾ç½®
â”‚   â”‚   â”‚       â”œâ”€â”€ RewardSettings.tsx     # å¥–åŠ±è®¾ç½®
â”‚   â”‚   â”‚       â”œâ”€â”€ ScoreEntry.tsx         # æˆç»©å½•å…¥
â”‚   â”‚   â”‚       â””â”€â”€ ReportExport.tsx       # æŠ¥å‘Šå¯¼å‡º
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ hooks/                   # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.ts           # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ useSync.ts           # æ•°æ®åŒæ­¥
â”‚   â”‚   â”‚   â”œâ”€â”€ useTimer.ts          # è®¡æ—¶å™¨é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ useLocalDB.ts        # IndexedDBæ“ä½œ
â”‚   â”‚   â”‚   â””â”€â”€ useStats.ts          # ç»Ÿè®¡è®¡ç®—
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ store/                   # çŠ¶æ€ç®¡ç†(Zustand)
â”‚   â”‚   â”‚   â”œâ”€â”€ authStore.ts         # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ planStore.ts         # è®¡åˆ’çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ syncStore.ts         # åŒæ­¥çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ uiStore.ts           # UIçŠ¶æ€
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ db/                      # IndexedDBé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ database.ts          # Dexieæ•°æ®åº“å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ migrations.ts        # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”‚   â””â”€â”€ repositories/        # æ•°æ®ä»“åº“
â”‚   â”‚   â”‚       â”œâ”€â”€ userRepo.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ planRepo.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ checkInRepo.ts
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                     # APIè°ƒç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts            # Axiosé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts              # è®¤è¯API
â”‚   â”‚   â”‚   â””â”€â”€ sync.ts              # åŒæ­¥API
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ date.ts              # æ—¥æœŸå¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ points.ts            # ç§¯åˆ†è®¡ç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ achievements.ts      # æˆå°±æ£€æµ‹
â”‚   â”‚   â”‚   â””â”€â”€ pdf.ts               # PDFç”Ÿæˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ types/                   # TypeScriptç±»å‹
â”‚   â”‚       â”œâ”€â”€ user.ts
â”‚   â”‚       â”œâ”€â”€ plan.ts
â”‚   â”‚       â”œâ”€â”€ checkIn.ts
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ components.json              # shadcn/uié…ç½®
â”‚
â”œâ”€â”€ server/                          # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts                 # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ app.ts                   # Expressåº”ç”¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routes/                  # è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts              # è®¤è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ sync.ts              # åŒæ­¥è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ user.ts              # ç”¨æˆ·è·¯ç”±
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ controllers/             # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ authController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ syncController.ts
â”‚   â”‚   â”‚   â””â”€â”€ userController.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/                # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ authService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ syncService.ts
â”‚   â”‚   â”‚   â””â”€â”€ userService.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ middleware/              # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts              # JWTéªŒè¯
â”‚   â”‚   â”‚   â”œâ”€â”€ errorHandler.ts      # é”™è¯¯å¤„ç†
â”‚   â”‚   â”‚   â””â”€â”€ validator.ts         # è¯·æ±‚éªŒè¯
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ jwt.ts
â”‚   â”‚       â””â”€â”€ password.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ schema.prisma            # æ•°æ®åº“Schema
â”‚   â”‚   â””â”€â”€ migrations/              # è¿ç§»æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore
â”œâ”€â”€ railway.json                     # Railwayé…ç½®
â”œâ”€â”€ Procfile                         # å¯åŠ¨å‘½ä»¤
â””â”€â”€ README.md
```

---

## äºŒã€å‰ç«¯æŠ€æœ¯è¯¦è§£

### 2.1 ä¾èµ–æ¸…å•

```json
{
  "dependencies": {
    // Reactæ ¸å¿ƒ
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.21.0",
    
    // UIæ¡†æ¶
    "tailwindcss": "^3.4.0",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.0",
    "tailwind-merge": "^2.2.0",
    
    // shadcn/ui ä¾èµ–
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-dropdown-menu": "^2.0.6",
    "@radix-ui/react-slider": "^1.1.2",
    "@radix-ui/react-switch": "^1.0.3",
    "@radix-ui/react-tabs": "^1.0.4",
    "@radix-ui/react-select": "^2.0.0",
    "@radix-ui/react-popover": "^1.0.7",
    
    // å›¾æ ‡
    "lucide-react": "^0.300.0",
    
    // çŠ¶æ€ç®¡ç†
    "zustand": "^4.4.7",
    "@tanstack/react-query": "^5.17.0",
    
    // æœ¬åœ°æ•°æ®åº“
    "dexie": "^3.2.4",
    "dexie-react-hooks": "^1.1.7",
    
    // è¡¨å•å¤„ç†
    "react-hook-form": "^7.49.3",
    "@hookform/resolvers": "^3.3.3",
    "zod": "^3.22.4",
    
    // æ—¥æœŸå¤„ç†
    "date-fns": "^3.0.0",
    "date-fns-tz": "^2.0.0",
    
    // HTTPå®¢æˆ·ç«¯
    "axios": "^1.6.5",
    
    // å›¾è¡¨
    "recharts": "^2.10.3",
    
    // PDFç”Ÿæˆ
    "jspdf": "^2.5.1",
    "html2canvas": "^1.4.1",
    
    // å·¥å…·åº“
    "uuid": "^9.0.0",
    "lodash-es": "^4.17.21"
  },
  "devDependencies": {
    "@types/react": "^18.2.45",
    "@types/react-dom": "^18.2.18",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.16",
    "postcss": "^8.4.32",
    "typescript": "^5.3.3",
    "vite": "^5.0.10",
    "vite-plugin-pwa": "^0.17.4"
  }
}
```

### 2.2 IndexedDBæ•°æ®åº“è®¾è®¡ (Dexie.js)

```typescript
// src/db/database.ts
import Dexie, { Table } from 'dexie';

// ç±»å‹å®šä¹‰
export interface User {
  id: string;
  phone?: string;
  email?: string;
  passwordHash: string;      // ç™»å½•å¯†ç å“ˆå¸Œï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
  parentPasswordHash: string; // å®¶é•¿å¯†ç å“ˆå¸Œ
  createdAt: Date;
  lastSyncAt?: Date;
}

export interface Child {
  id: string;
  userId: string;
  name: string;
  avatar?: string;
  grade: number;             // 1-6å¹´çº§
  semester: 'first' | 'second';
  birthday?: Date;
  createdAt: Date;
  updatedAt: Date;
  syncedAt?: Date;
}

export interface Subject {
  id: string;
  name: string;
  icon: string;
  color: string;
  isSystem: boolean;         // æ˜¯å¦ç³»ç»Ÿé¢„è®¾
  sortOrder: number;
  createdAt: Date;
}

export interface TaskTemplate {
  id: string;
  childId: string;
  subjectId: string;
  name: string;
  description?: string;
  defaultDuration: number;   // é»˜è®¤æ—¶é•¿(åˆ†é’Ÿ)
  hasReward: boolean;
  showSummary: boolean;
  createdAt: Date;
  updatedAt: Date;
  syncedAt?: Date;
}

export interface StudyPlan {
  id: string;
  childId: string;
  subjectId: string;
  templateId?: string;
  name: string;
  description?: string;
  plannedStartTime?: string; // HH:mm
  plannedEndTime?: string;   // HH:mm
  plannedDuration?: number;  // è®¡åˆ’æ—¶é•¿(åˆ†é’Ÿ)
  autoComplete: boolean;     // åˆ°æ—¶è‡ªåŠ¨å®Œæˆ
  repeatType: 'once' | 'daily' | 'weekday' | 'weekend' | 'custom';
  repeatDays?: number[];     // è‡ªå®šä¹‰é‡å¤ [0-6]
  startDate: string;         // YYYY-MM-DD
  endDate: string;           // YYYY-MM-DD
  hasReward: boolean;
  rewardPoints?: number;
  penaltyPoints?: number;
  showSummary: boolean;
  createdAt: Date;
  updatedAt: Date;
  syncedAt?: Date;
  isDeleted: boolean;        // è½¯åˆ é™¤æ ‡è®°
}

export interface CheckInRecord {
  id: string;
  childId: string;
  planId: string;
  date: string;              // YYYY-MM-DD
  status: 'pending' | 'in_progress' | 'completed' | 'overdue' | 'auto_completed' | 'manual_completed' | 'missed';
  actualStartTime?: Date;
  actualEndTime?: Date;
  actualDuration?: number;   // å®é™…ç”¨æ—¶(ç§’)
  earnedPoints?: number;
  summary?: string;          // å­¦ä¹ æ€»ç»“
  createdAt: Date;
  updatedAt: Date;
  syncedAt?: Date;
}

export interface Achievement {
  id: string;
  childId?: string;          // nullè¡¨ç¤ºç³»ç»Ÿé¢„è®¾
  name: string;
  description: string;
  icon: string;
  color: string;
  conditionType: string;
  conditionValue: number;
  isSystem: boolean;
  createdAt: Date;
  syncedAt?: Date;
}

export interface UnlockedAchievement {
  id: string;
  childId: string;
  achievementId: string;
  unlockedAt: Date;
  syncedAt?: Date;
}

export interface Reward {
  id: string;
  userId: string;
  name: string;
  description?: string;
  pointsCost: number;
  icon: string;
  stock?: number;            // åº“å­˜ï¼Œnullè¡¨ç¤ºæ— é™
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
  syncedAt?: Date;
}

export interface RewardRedemption {
  id: string;
  childId: string;
  rewardId: string;
  pointsSpent: number;
  status: 'pending' | 'fulfilled' | 'cancelled';
  redeemedAt: Date;
  fulfilledAt?: Date;
  syncedAt?: Date;
}

export interface ExamRecord {
  id: string;
  childId: string;
  academicYear: number;      // å­¦å¹´
  grade: number;
  semester: 'first' | 'second';
  examDate: string;
  examName: string;
  examType: string;          // å•å…ƒæµ‹/æœŸä¸­/æœŸæœ«
  subjectId: string;
  totalScore?: number;
  score: number;
  targetScore?: number;
  classAverage?: number;
  classMax?: number;
  classMedian?: number;
  performance?: string;
  rankings?: Array<{
    type: string;            // ç­çº§/å¹´çº§
    rank: number;
  }>;
  weaknesses?: Array<{
    questionType: string;
    knowledgePoint: string;
    totalPoints: number;
    earnedPoints: number;
    lossRate: number;
  }>;
  summary?: string;
  createdAt: Date;
  updatedAt: Date;
  syncedAt?: Date;
}

export interface PointsLog {
  id: string;
  childId: string;
  type: 'earn' | 'spend' | 'penalty';
  amount: number;
  reason: string;
  relatedId?: string;        // å…³è”çš„ä»»åŠ¡/å¥–åŠ±ID
  createdAt: Date;
  syncedAt?: Date;
}

export interface SyncMeta {
  id: string;
  tableName: string;
  lastSyncAt: Date;
  pendingChanges: number;
}

// æ•°æ®åº“ç±»
class StudyCheckinDB extends Dexie {
  users!: Table<User>;
  children!: Table<Child>;
  subjects!: Table<Subject>;
  taskTemplates!: Table<TaskTemplate>;
  studyPlans!: Table<StudyPlan>;
  checkInRecords!: Table<CheckInRecord>;
  achievements!: Table<Achievement>;
  unlockedAchievements!: Table<UnlockedAchievement>;
  rewards!: Table<Reward>;
  rewardRedemptions!: Table<RewardRedemption>;
  examRecords!: Table<ExamRecord>;
  pointsLogs!: Table<PointsLog>;
  syncMeta!: Table<SyncMeta>;

  constructor() {
    super('StudyCheckinDB');
    
    this.version(1).stores({
      users: 'id, phone, email',
      children: 'id, userId, name',
      subjects: 'id, name, isSystem, sortOrder',
      taskTemplates: 'id, childId, subjectId, name',
      studyPlans: 'id, childId, subjectId, startDate, endDate, isDeleted',
      checkInRecords: 'id, childId, planId, date, status',
      achievements: 'id, childId, isSystem, conditionType',
      unlockedAchievements: 'id, childId, achievementId',
      rewards: 'id, userId, isActive',
      rewardRedemptions: 'id, childId, rewardId, status',
      examRecords: 'id, childId, subjectId, examDate',
      pointsLogs: 'id, childId, type, createdAt',
      syncMeta: 'id, tableName'
    });
  }
}

export const db = new StudyCheckinDB();

// åˆå§‹åŒ–ç³»ç»Ÿæ•°æ®
export async function initializeSystemData() {
  // æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–
  const existingSubjects = await db.subjects.where('isSystem').equals(1).count();
  if (existingSubjects > 0) return;

  // æ’å…¥é¢„è®¾ç§‘ç›®
  const systemSubjects: Subject[] = [
    { id: 'subj_yuwen', name: 'è¯­æ–‡', icon: 'ğŸ“–', color: '#4A90D9', isSystem: true, sortOrder: 1, createdAt: new Date() },
    { id: 'subj_shuxue', name: 'æ•°å­¦', icon: 'ğŸ”¢', color: '#5CB85C', isSystem: true, sortOrder: 2, createdAt: new Date() },
    { id: 'subj_yingyu', name: 'è‹±è¯­', icon: 'ğŸ”¤', color: '#F0AD4E', isSystem: true, sortOrder: 3, createdAt: new Date() },
    { id: 'subj_wuli', name: 'ç‰©ç†', icon: 'âš›ï¸', color: '#9B59B6', isSystem: true, sortOrder: 4, createdAt: new Date() },
    { id: 'subj_huaxue', name: 'åŒ–å­¦', icon: 'ğŸ§ª', color: '#E74C3C', isSystem: true, sortOrder: 5, createdAt: new Date() },
    { id: 'subj_shengwu', name: 'ç”Ÿç‰©', icon: 'ğŸŒ±', color: '#27AE60', isSystem: true, sortOrder: 6, createdAt: new Date() },
    { id: 'subj_dili', name: 'åœ°ç†', icon: 'ğŸŒ', color: '#3498DB', isSystem: true, sortOrder: 7, createdAt: new Date() },
    { id: 'subj_lishi', name: 'å†å²', icon: 'ğŸ“œ', color: '#8B4513', isSystem: true, sortOrder: 8, createdAt: new Date() },
    { id: 'subj_daofa', name: 'é“æ³•', icon: 'âš–ï¸', color: '#E91E63', isSystem: true, sortOrder: 9, createdAt: new Date() },
    { id: 'subj_kexue', name: 'ç§‘å­¦', icon: 'ğŸ”¬', color: '#00BCD4', isSystem: true, sortOrder: 10, createdAt: new Date() },
    { id: 'subj_yundong', name: 'è¿åŠ¨', icon: 'ğŸƒ', color: '#FF5722', isSystem: true, sortOrder: 11, createdAt: new Date() },
    { id: 'subj_jineng', name: 'æŠ€èƒ½', icon: 'ğŸ’¡', color: '#607D8B', isSystem: true, sortOrder: 12, createdAt: new Date() },
    { id: 'subj_jianshi', name: 'è§è¯†', icon: 'ğŸŒ', color: '#795548', isSystem: true, sortOrder: 13, createdAt: new Date() },
  ];

  await db.subjects.bulkAdd(systemSubjects);

  // æ’å…¥é¢„è®¾å‹‹ç« 
  const systemAchievements: Achievement[] = [
    // åšæŒç³»åˆ—
    { id: 'ach_3days', childId: undefined, name: 'åˆè¯•ç‰›åˆ€', description: 'è¿ç»­æ‰“å¡3å¤©', icon: 'flame', color: '#FF6B6B', conditionType: 'consecutive_days', conditionValue: 3, isSystem: true, createdAt: new Date() },
    { id: 'ach_7days', childId: undefined, name: 'æ¸å…¥ä½³å¢ƒ', description: 'è¿ç»­æ‰“å¡7å¤©', icon: 'star', color: '#FFD93D', conditionType: 'consecutive_days', conditionValue: 7, isSystem: true, createdAt: new Date() },
    { id: 'ach_30days', childId: undefined, name: 'æŒä¹‹ä»¥æ’', description: 'è¿ç»­æ‰“å¡30å¤©', icon: 'muscle', color: '#6BCB77', conditionType: 'consecutive_days', conditionValue: 30, isSystem: true, createdAt: new Date() },
    { id: 'ach_100days', childId: undefined, name: 'å­¦ä¹ ä¹‹ç‹', description: 'è¿ç»­æ‰“å¡100å¤©', icon: 'crown', color: '#9B59B6', conditionType: 'consecutive_days', conditionValue: 100, isSystem: true, createdAt: new Date() },
    // æ—¶é•¿ç³»åˆ—
    { id: 'ach_10hours', childId: undefined, name: 'èµ·æ­¥é˜¶æ®µ', description: 'ç´¯è®¡å­¦ä¹ 10å°æ—¶', icon: 'clock', color: '#74B9FF', conditionType: 'total_study_hours', conditionValue: 10, isSystem: true, createdAt: new Date() },
    { id: 'ach_50hours', childId: undefined, name: 'å‹¤å¥‹å¥½å­¦', description: 'ç´¯è®¡å­¦ä¹ 50å°æ—¶', icon: 'book', color: '#A29BFE', conditionType: 'total_study_hours', conditionValue: 50, isSystem: true, createdAt: new Date() },
    { id: 'ach_100hours', childId: undefined, name: 'å­¦éœ¸å…»æˆ', description: 'ç´¯è®¡å­¦ä¹ 100å°æ—¶', icon: 'graduation-cap', color: '#FD79A8', conditionType: 'total_study_hours', conditionValue: 100, isSystem: true, createdAt: new Date() },
    { id: 'ach_500hours', childId: undefined, name: 'å­¦ç¥é™ä¸´', description: 'ç´¯è®¡å­¦ä¹ 500å°æ—¶', icon: 'trophy', color: '#FDCB6E', conditionType: 'total_study_hours', conditionValue: 500, isSystem: true, createdAt: new Date() },
    // ç‰¹æ®Šæˆå°±
    { id: 'ach_early_bird', childId: undefined, name: 'æ—©èµ·é¸Ÿ', description: 'æ—©ä¸Š7ç‚¹å‰æ‰“å¡10æ¬¡', icon: 'sunrise', color: '#FF9F43', conditionType: 'early_bird', conditionValue: 10, isSystem: true, createdAt: new Date() },
    { id: 'ach_perfect_week', childId: undefined, name: 'å®Œç¾ä¸»ä¹‰', description: 'è¿ç»­7å¤©100%å®Œæˆç‡', icon: 'target', color: '#00D2D3', conditionType: 'perfect_days', conditionValue: 7, isSystem: true, createdAt: new Date() },
  ];

  await db.achievements.bulkAdd(systemAchievements);
}
```

### 2.3 çŠ¶æ€ç®¡ç† (Zustand)

```typescript
// src/store/authStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AuthState {
  isAuthenticated: boolean;
  userId: string | null;
  currentChildId: string | null;
  mode: 'child' | 'parent';
  
  // Actions
  login: (userId: string, childId: string) => void;
  logout: () => void;
  switchChild: (childId: string) => void;
  switchToParentMode: () => void;
  switchToChildMode: (childId: string) => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      isAuthenticated: false,
      userId: null,
      currentChildId: null,
      mode: 'child',

      login: (userId, childId) => set({
        isAuthenticated: true,
        userId,
        currentChildId: childId,
        mode: 'child'
      }),

      logout: () => set({
        isAuthenticated: false,
        userId: null,
        currentChildId: null,
        mode: 'child'
      }),

      switchChild: (childId) => set({ currentChildId: childId }),

      switchToParentMode: () => set({ mode: 'parent' }),

      switchToChildMode: (childId) => set({
        mode: 'child',
        currentChildId: childId
      }),
    }),
    {
      name: 'auth-storage',
    }
  )
);
```

```typescript
// src/store/syncStore.ts
import { create } from 'zustand';

type SyncStatus = 'synced' | 'pending' | 'syncing' | 'error' | 'offline';

interface SyncState {
  status: SyncStatus;
  lastSyncAt: Date | null;
  pendingChanges: number;
  errorMessage: string | null;
  
  // Actions
  setStatus: (status: SyncStatus) => void;
  setSynced: (time: Date) => void;
  setError: (message: string) => void;
  incrementPending: () => void;
  resetPending: () => void;
}

export const useSyncStore = create<SyncState>((set) => ({
  status: 'synced',
  lastSyncAt: null,
  pendingChanges: 0,
  errorMessage: null,

  setStatus: (status) => set({ status, errorMessage: null }),
  
  setSynced: (time) => set({
    status: 'synced',
    lastSyncAt: time,
    pendingChanges: 0,
    errorMessage: null
  }),
  
  setError: (message) => set({
    status: 'error',
    errorMessage: message
  }),
  
  incrementPending: () => set((state) => ({
    pendingChanges: state.pendingChanges + 1,
    status: 'pending'
  })),
  
  resetPending: () => set({ pendingChanges: 0 }),
}));
```

### 2.4 åŒæ­¥Hook

```typescript
// src/hooks/useSync.ts
import { useCallback, useState } from 'react';
import { useSyncStore } from '../store/syncStore';
import { db } from '../db/database';
import { syncApi } from '../api/sync';

export function useSync() {
  const { status, lastSyncAt, pendingChanges, setStatus, setSynced, setError } = useSyncStore();
  const [isLoading, setIsLoading] = useState(false);

  const sync = useCallback(async () => {
    if (status === 'syncing') return;
    
    setIsLoading(true);
    setStatus('syncing');

    try {
      // 1. æ”¶é›†æœ¬åœ°æ›´æ”¹
      const lastSync = lastSyncAt || new Date(0);
      
      const changes = {
        children: await getChangedRecords(db.children, lastSync),
        taskTemplates: await getChangedRecords(db.taskTemplates, lastSync),
        studyPlans: await getChangedRecords(db.studyPlans, lastSync),
        checkInRecords: await getChangedRecords(db.checkInRecords, lastSync),
        achievements: await getChangedRecords(db.achievements, lastSync),
        unlockedAchievements: await getChangedRecords(db.unlockedAchievements, lastSync),
        rewards: await getChangedRecords(db.rewards, lastSync),
        rewardRedemptions: await getChangedRecords(db.rewardRedemptions, lastSync),
        examRecords: await getChangedRecords(db.examRecords, lastSync),
        pointsLogs: await getChangedRecords(db.pointsLogs, lastSync),
      };

      // 2. å‘é€åˆ°æœåŠ¡å™¨
      const response = await syncApi.sync({
        lastSyncTime: lastSync.toISOString(),
        changes,
      });

      // 3. åº”ç”¨æœåŠ¡å™¨æ›´æ”¹
      await applyServerChanges(response.serverChanges);

      // 4. æ›´æ–°åŒæ­¥æ—¶é—´
      const newSyncTime = new Date(response.newSyncTime);
      setSynced(newSyncTime);

    } catch (error: any) {
      console.error('Sync failed:', error);
      setError(error.message || 'åŒæ­¥å¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      setIsLoading(false);
    }
  }, [status, lastSyncAt, setStatus, setSynced, setError]);

  return {
    status,
    lastSyncAt,
    pendingChanges,
    isLoading,
    sync,
  };
}

// è¾…åŠ©å‡½æ•°ï¼šè·å–æ›´æ”¹çš„è®°å½•
async function getChangedRecords(table: any, since: Date) {
  return table
    .filter((record: any) => 
      !record.syncedAt || new Date(record.updatedAt) > since
    )
    .toArray();
}

// è¾…åŠ©å‡½æ•°ï¼šåº”ç”¨æœåŠ¡å™¨æ›´æ”¹
async function applyServerChanges(serverChanges: any) {
  const now = new Date();
  
  for (const [tableName, records] of Object.entries(serverChanges)) {
    if (!records || !Array.isArray(records)) continue;
    
    const table = (db as any)[tableName];
    if (!table) continue;

    for (const record of records) {
      await table.put({
        ...record,
        syncedAt: now,
      });
    }
  }
}
```

### 2.5 è®¡æ—¶å™¨Hook

```typescript
// src/hooks/useTimer.ts
import { useState, useRef, useCallback, useEffect } from 'react';

interface TimerState {
  seconds: number;
  isRunning: boolean;
  isPaused: boolean;
}

export function useTimer(initialSeconds = 0) {
  const [state, setState] = useState<TimerState>({
    seconds: initialSeconds,
    isRunning: false,
    isPaused: false,
  });
  
  const intervalRef = useRef<NodeJS.Timeout | null>(null);
  const startTimeRef = useRef<Date | null>(null);

  const start = useCallback(() => {
    if (state.isRunning && !state.isPaused) return;
    
    startTimeRef.current = new Date();
    setState(prev => ({ ...prev, isRunning: true, isPaused: false }));
    
    intervalRef.current = setInterval(() => {
      setState(prev => ({ ...prev, seconds: prev.seconds + 1 }));
    }, 1000);
  }, [state.isRunning, state.isPaused]);

  const pause = useCallback(() => {
    if (!state.isRunning || state.isPaused) return;
    
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
    
    setState(prev => ({ ...prev, isPaused: true }));
  }, [state.isRunning, state.isPaused]);

  const resume = useCallback(() => {
    if (!state.isRunning || !state.isPaused) return;
    
    setState(prev => ({ ...prev, isPaused: false }));
    
    intervalRef.current = setInterval(() => {
      setState(prev => ({ ...prev, seconds: prev.seconds + 1 }));
    }, 1000);
  }, [state.isRunning, state.isPaused]);

  const stop = useCallback(() => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
    
    const endTime = new Date();
    const duration = state.seconds;
    
    setState({ seconds: 0, isRunning: false, isPaused: false });
    
    return {
      startTime: startTimeRef.current,
      endTime,
      duration,
    };
  }, [state.seconds]);

  const reset = useCallback(() => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }
    startTimeRef.current = null;
    setState({ seconds: 0, isRunning: false, isPaused: false });
  }, []);

  // æ¸…ç†
  useEffect(() => {
    return () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
      }
    };
  }, []);

  // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
  const formatTime = useCallback((totalSeconds: number) => {
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    
    return {
      hours: hours.toString().padStart(2, '0'),
      minutes: minutes.toString().padStart(2, '0'),
      seconds: seconds.toString().padStart(2, '0'),
      display: hours > 0 
        ? `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
        : `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`,
    };
  }, []);

  return {
    ...state,
    formatted: formatTime(state.seconds),
    start,
    pause,
    resume,
    stop,
    reset,
  };
}
```

---

## ä¸‰ã€åç«¯æŠ€æœ¯è¯¦è§£

### 3.1 ä¾èµ–æ¸…å•

```json
{
  "dependencies": {
    "express": "^4.18.2",
    "@prisma/client": "^5.8.0",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.2",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express-validator": "^7.0.1",
    "compression": "^1.7.4",
    "helmet": "^7.1.0",
    "morgan": "^1.10.0"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/bcryptjs": "^2.4.6",
    "@types/jsonwebtoken": "^9.0.5",
    "@types/cors": "^2.8.17",
    "@types/compression": "^1.7.5",
    "@types/morgan": "^1.9.9",
    "prisma": "^5.8.0",
    "typescript": "^5.3.3",
    "ts-node": "^10.9.2",
    "nodemon": "^3.0.2"
  }
}
```

### 3.2 Expressåº”ç”¨é…ç½®

```typescript
// src/app.ts
import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import compression from 'compression';
import morgan from 'morgan';
import { errorHandler } from './middleware/errorHandler';
import authRoutes from './routes/auth';
import syncRoutes from './routes/sync';
import userRoutes from './routes/user';

const app = express();

// ä¸­é—´ä»¶
app.use(helmet());
app.use(cors({
  origin: process.env.CLIENT_URL || 'http://localhost:5173',
  credentials: true,
}));
app.use(compression());
app.use(morgan('combined'));
app.use(express.json({ limit: '10mb' }));

// è·¯ç”±
app.use('/api/auth', authRoutes);
app.use('/api/sync', syncRoutes);
app.use('/api/user', userRoutes);

// å¥åº·æ£€æŸ¥
app.get('/health', (req, res) => {
  res.json({ status: 'ok', timestamp: new Date().toISOString() });
});

// é”™è¯¯å¤„ç†
app.use(errorHandler);

export default app;
```

### 3.3 åŒæ­¥APIè®¾è®¡

```typescript
// src/routes/sync.ts
import { Router } from 'express';
import { body } from 'express-validator';
import { authenticate } from '../middleware/auth';
import { syncController } from '../controllers/syncController';

const router = Router();

// åŒæ­¥æ•°æ®
router.post(
  '/',
  authenticate,
  [
    body('lastSyncTime').isISO8601().withMessage('æ— æ•ˆçš„åŒæ­¥æ—¶é—´'),
    body('changes').isObject().withMessage('æ›´æ”¹æ•°æ®æ ¼å¼é”™è¯¯'),
  ],
  syncController.sync
);

// è·å–åˆå§‹æ•°æ®ï¼ˆé¦–æ¬¡ç™»å½•ï¼‰
router.get(
  '/initial',
  authenticate,
  syncController.getInitialData
);

export default router;
```

```typescript
// src/controllers/syncController.ts
import { Request, Response, NextFunction } from 'express';
import { validationResult } from 'express-validator';
import { syncService } from '../services/syncService';

export const syncController = {
  async sync(req: Request, res: Response, next: NextFunction) {
    try {
      const errors = validationResult(req);
      if (!errors.isEmpty()) {
        return res.status(400).json({ errors: errors.array() });
      }

      const userId = req.user!.id;
      const { lastSyncTime, changes } = req.body;

      const result = await syncService.processSync(
        userId,
        new Date(lastSyncTime),
        changes
      );

      res.json(result);
    } catch (error) {
      next(error);
    }
  },

  async getInitialData(req: Request, res: Response, next: NextFunction) {
    try {
      const userId = req.user!.id;
      const data = await syncService.getInitialData(userId);
      res.json(data);
    } catch (error) {
      next(error);
    }
  },
};
```

```typescript
// src/services/syncService.ts
import { prisma } from '../prisma';

export const syncService = {
  async processSync(userId: string, lastSyncTime: Date, changes: any) {
    const newSyncTime = new Date();

    // 1. å¤„ç†å®¢æˆ·ç«¯ä¸Šä¼ çš„æ›´æ”¹
    await this.applyClientChanges(userId, changes);

    // 2. è·å–æœåŠ¡å™¨ç«¯çš„æ›´æ”¹ï¼ˆå…¶ä»–è®¾å¤‡åŒæ­¥çš„æ•°æ®ï¼‰
    const serverChanges = await this.getServerChanges(userId, lastSyncTime);

    return {
      serverChanges,
      newSyncTime: newSyncTime.toISOString(),
      conflicts: [], // æš‚ä¸å¤„ç†å†²çª
    };
  },

  async applyClientChanges(userId: string, changes: any) {
    // ä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§
    await prisma.$transaction(async (tx) => {
      // å¤„ç†æ¯ä¸ªè¡¨çš„æ›´æ”¹
      for (const [tableName, records] of Object.entries(changes)) {
        if (!records || !Array.isArray(records)) continue;

        for (const record of records) {
          // éªŒè¯è®°å½•å±äºè¯¥ç”¨æˆ·
          if (!this.validateOwnership(userId, tableName, record)) {
            continue;
          }

          // Upsertæ“ä½œ
          await this.upsertRecord(tx, tableName, record);
        }
      }
    });
  },

  async getServerChanges(userId: string, since: Date) {
    // è·å–è¯¥ç”¨æˆ·åœ¨sinceä¹‹åæ›´æ–°çš„æ‰€æœ‰è®°å½•
    const children = await prisma.child.findMany({
      where: { userId, updatedAt: { gt: since } },
    });

    const childIds = children.map(c => c.id);

    const [
      taskTemplates,
      studyPlans,
      checkInRecords,
      achievements,
      unlockedAchievements,
      rewards,
      rewardRedemptions,
      examRecords,
      pointsLogs,
    ] = await Promise.all([
      prisma.taskTemplate.findMany({
        where: { childId: { in: childIds }, updatedAt: { gt: since } },
      }),
      prisma.studyPlan.findMany({
        where: { childId: { in: childIds }, updatedAt: { gt: since } },
      }),
      prisma.checkInRecord.findMany({
        where: { childId: { in: childIds }, updatedAt: { gt: since } },
      }),
      prisma.achievement.findMany({
        where: {
          OR: [
            { isSystem: true },
            { childId: { in: childIds } },
          ],
          updatedAt: { gt: since },
        },
      }),
      prisma.unlockedAchievement.findMany({
        where: { childId: { in: childIds }, unlockedAt: { gt: since } },
      }),
      prisma.reward.findMany({
        where: { userId, updatedAt: { gt: since } },
      }),
      prisma.rewardRedemption.findMany({
        where: { childId: { in: childIds }, redeemedAt: { gt: since } },
      }),
      prisma.examRecord.findMany({
        where: { childId: { in: childIds }, updatedAt: { gt: since } },
      }),
      prisma.pointsLog.findMany({
        where: { childId: { in: childIds }, createdAt: { gt: since } },
      }),
    ]);

    return {
      children,
      taskTemplates,
      studyPlans,
      checkInRecords,
      achievements,
      unlockedAchievements,
      rewards,
      rewardRedemptions,
      examRecords,
      pointsLogs,
    };
  },

  async getInitialData(userId: string) {
    // é¦–æ¬¡ç™»å½•ï¼Œä¸‹è½½æ‰€æœ‰æ•°æ®
    return this.getServerChanges(userId, new Date(0));
  },

  validateOwnership(userId: string, tableName: string, record: any): boolean {
    // éªŒè¯è®°å½•æ‰€æœ‰æƒçš„é€»è¾‘
    // æ ¹æ®è¡¨åå’Œè®°å½•å†…å®¹åˆ¤æ–­æ˜¯å¦å±äºè¯¥ç”¨æˆ·
    return true; // ç®€åŒ–ç¤ºä¾‹
  },

  async upsertRecord(tx: any, tableName: string, record: any) {
    const model = (tx as any)[tableName];
    if (!model) return;

    await model.upsert({
      where: { id: record.id },
      create: record,
      update: record,
    });
  },
};
```

---

## å››ã€Railwayéƒ¨ç½²é…ç½®

### 4.1 railway.json

```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "numReplicas": 1,
    "sleepApplication": false,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### 4.2 Procfile

```
web: cd server && npm run start
```

### 4.3 ç¯å¢ƒå˜é‡ (.env.example)

```bash
# æ•°æ®åº“
DATABASE_URL="postgresql://user:password@host:5432/dbname"

# JWT
JWT_SECRET="your-super-secret-jwt-key-change-in-production"
JWT_EXPIRES_IN="30d"

# æœåŠ¡å™¨
PORT=3000
NODE_ENV=production

# å®¢æˆ·ç«¯URLï¼ˆCORSï¼‰
CLIENT_URL="https://your-app.railway.app"
```

### 4.4 éƒ¨ç½²æ­¥éª¤

1. **åˆ›å»ºRailwayé¡¹ç›®**
   ```bash
   # å®‰è£…Railway CLI
   npm install -g @railway/cli
   
   # ç™»å½•
   railway login
   
   # åˆå§‹åŒ–é¡¹ç›®
   railway init
   ```

2. **æ·»åŠ PostgreSQL**
   - åœ¨Railwayæ§åˆ¶å°æ·»åŠ PostgreSQLæœåŠ¡
   - è‡ªåŠ¨è·å¾—DATABASE_URLç¯å¢ƒå˜é‡

3. **é…ç½®ç¯å¢ƒå˜é‡**
   - åœ¨Railwayæ§åˆ¶å°è®¾ç½®JWT_SECRETç­‰å˜é‡

4. **éƒ¨ç½²**
   ```bash
   railway up
   ```

5. **è¿è¡Œæ•°æ®åº“è¿ç§»**
   ```bash
   railway run npx prisma migrate deploy
   ```

---

## äº”ã€PWAé…ç½®

### 5.1 manifest.json

```json
{
  "name": "å¥½å­¦ä¼´ - å­¦ä¹ æ‰“å¡åŠ©æ‰‹",
  "short_name": "å¥½å­¦ä¼´",
  "description": "å¸®åŠ©å­©å­å…»æˆè‰¯å¥½å­¦ä¹ ä¹ æƒ¯çš„æ‰“å¡ç»Ÿè®¡å¹³å°",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#4A5568",
  "theme_color": "#4A90D9",
  "orientation": "portrait-primary",
  "icons": [
    {
      "src": "/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-96x96.png",
      "sizes": "96x96",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

### 5.2 Vite PWAé…ç½®

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { VitePWA } from 'vite-plugin-pwa';

export default defineConfig({
  plugins: [
    react(),
    VitePWA({
      registerType: 'autoUpdate',
      includeAssets: ['favicon.ico', 'icons/*.png'],
      manifest: {
        name: 'å¥½å­¦ä¼´ - å­¦ä¹ æ‰“å¡åŠ©æ‰‹',
        short_name: 'å¥½å­¦ä¼´',
        description: 'å¸®åŠ©å­©å­å…»æˆè‰¯å¥½å­¦ä¹ ä¹ æƒ¯çš„æ‰“å¡ç»Ÿè®¡å¹³å°',
        theme_color: '#4A90D9',
        background_color: '#4A5568',
        display: 'standalone',
        icons: [
          {
            src: '/icons/icon-192x192.png',
            sizes: '192x192',
            type: 'image/png',
          },
          {
            src: '/icons/icon-512x512.png',
            sizes: '512x512',
            type: 'image/png',
          },
        ],
      },
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg}'],
        runtimeCaching: [
          {
            urlPattern: /^https:\/\/api\./i,
            handler: 'NetworkFirst',
            options: {
              cacheName: 'api-cache',
              expiration: {
                maxEntries: 100,
                maxAgeSeconds: 60 * 60 * 24, // 24å°æ—¶
              },
            },
          },
        ],
      },
    }),
  ],
});
```

