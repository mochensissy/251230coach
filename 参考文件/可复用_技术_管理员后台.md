# 可复用_技术_管理员后台管理模块

## 需求描述
提供一个独立于前台App的 Web 后台，供管理员查看数据、管理用户和系统配置。

## 架构建议
建议将前台 (App/Client) 和后台 (Admin) 集成在同一个前端项目中，通过路由 (`/admin/*`) 区分，共用组件库和工具函数，但通过权限守卫隔离。

## 页面结构设计

后台通常包含以下核心模块：

1.  **概览仪表盘 (Dashboard)**
    *   **KPI卡片**：总用户数、今日活跃、今日新增、总收入。
    *   **趋势图**：近30天用户增长曲线。
2.  **用户管理 (User Management)**
    *   列表页：展示 User ID, 昵称, 手机号, 会员状态, 注册时间。
    *   操作：封禁/解封、修改会员有效期（人工补单）、重置密码。
3.  **激活码管理 (Key Management)**
    *   生成器：批量生成 Key。
    *   列表：查看 Key 的使用状态和使用者。
4.  **数据分析 (Analytics)**
    *   行为分析：热门页面、功能使用率。
    *   留存分析：次日留存、周留存。

## 权限控制实现

前端路由守卫 (`RequireAdmin`)：

```typescript
// components/auth/RequireAdmin.tsx
export function RequireAdmin({ children }) {
    const { user, role } = useAuth();
    
    // 1. 未登录 -> 去登录页
    if (!user) return <Navigate to="/login" />;
    
    // 2. 角色不是管理员 -> 403 / 首页
    if (role !== 'admin') {
        return <div className="p-8 text-center text-red-500">无权访问</div>;
    }
    
    return children;
}

// 路由定义
<Route path="/admin" element={<RequireAdmin><AdminLayout /></RequireAdmin>}>
    <Route index element={<Overview />} />
    <Route path="users" element={<UserList />} />
    <Route path="keys" element={<KeyList />} />
</Route>
```

后端 API 中间件 (`verifyAdmin`)：

```typescript
// middleware/auth.ts
export const verifyAdmin = async (req, res, next) => {
    const user = req.user; // 假设已被 verifyToken 解析
    if (user.role !== 'admin') {
        return res.status(403).json({ error: 'Requires admin privilege' });
    }
    next();
};

// 路由使用
app.get('/api/admin/stats', verifyToken, verifyAdmin, adminController.getStats);
```
