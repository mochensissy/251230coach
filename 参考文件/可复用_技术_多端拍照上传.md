# 可复用_技术_多端拍照上传

## 需求描述
实现一个兼容电脑、平板、手机的图片获取功能。
*   **电脑端**：弹出文件选择框，选择本地图片。
*   **移动端 (手机/平板)**：直接调起摄像头拍照，或者从相册选择。

## 核心实现：HTML5 Canvas + Input

不需要原生开发，只需合理配置 `<input type="file" />` 属性即可。

### 1. 核心属性配置

```html
<input
    type="file"
    accept="image/*"        
    capture="environment"   
    onChange={handleFileSelect}
/>
```

*   `accept="image/*"`: 限制只能选择图片。
*   `capture="environment"`: **关键属性**。
    *   在移动端（iOS/Android Webview中），这会优先尝试**直接调起后置摄像头**。
    *   如果没有这个属性，移动端通常会弹出一个选择菜单（“拍照”、“从相册选择”、“选择文件”）。
    *   `capture="user"` 则调起前置摄像头。
    *   在 PC 端，此属性会被忽略，直接打开文件资源管理器。

### 2. UI 触发逻辑
通常我们会隐藏丑陋的原生 `input`，用一个美观的按钮触发它。

```typescript
// React 示例
import { useRef } from 'react';

export function ImageUploader() {
    const fileInputRef = useRef<HTMLInputElement>(null);

    const handleClick = () => {
        // 触发隐藏 input 的点击事件
        fileInputRef.current?.click();
    };

    const handleFileSelect = (e) => {
        const file = e.target.files?.[0];
        if (file) {
            // 处理文件：上传、预览或 OCR
            console.log("Got file:", file);
        }
    };

    return (
        <>
            <button onClick={handleClick} className="btn-primary">
                <CameraIcon /> 拍照/上传
            </button>
            <input
                ref={fileInputRef}
                type="file"
                accept="image/*"
                capture="environment" // 手机端优先唤起相机
                className="hidden" // 隐藏
                onChange={handleFileSelect}
            />
        </>
    );
}
```

### 3. 图片压缩 (优化体验)
手机拍出的照片通常很大 (5MB+)，直接上传或处理会很慢。建议在前端先压缩。

可以使用 `browser-image-compression` 库或 Canvas API。

```typescript
import imageCompression from 'browser-image-compression';

async function handleFile(file) {
    const options = {
        maxSizeMB: 1,          // 限制最大 1MB
        maxWidthOrHeight: 1920, // 限制最大分辨率
        useWebWorker: true
    };
    
    try {
        const compressedFile = await imageCompression(file, options);
        // 上传 compressedFile
    } catch (error) {
        console.log(error);
    }
}
```
