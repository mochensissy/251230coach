# 需求详细说明

## 一、用户系统

### 1.1 账号体系
```
一个账号 = 一个家庭
├── 家长身份（需密码验证）
└── 小孩档案（最多5个）
    ├── 小孩1
    ├── 小孩2
    └── ...
```

### 1.2 注册流程
1. 输入手机号/邮箱
2. 设置登录密码
3. 设置家长管理密码（用于切换家长模式）
4. 创建第一个小孩档案（姓名、年级）
5. 完成注册

### 1.3 登录流程
```
打开应用
    ↓
检查本地会话
    ↓
├── 有会话 → 自动进入小孩模式（上次选择的小孩）
└── 无会话 → 显示登录页面
              ↓
          输入账号密码
              ↓
          选择进入模式
          ├── 小孩模式 → 选择小孩档案 → 进入主界面
          └── 家长模式 → 输入家长密码 → 进入管理界面
```

### 1.4 模式切换
- 小孩界面右上角显示当前小孩名字
- 点击名字弹出菜单：
  - 切换小孩（同账号其他小孩）
  - 切换到家长模式（需输入家长密码）
  - 退出登录

### 1.5 小孩档案信息
| 字段 | 必填 | 说明 |
|------|------|------|
| 姓名/昵称 | ✅ | 显示名称 |
| 头像 | ❌ | 可选预设头像 |
| 年级 | ✅ | 一年级~六年级 |
| 学期 | ✅ | 上学期/下学期 |
| 生日 | ❌ | 用于生日祝福 |

---

## 二、计划模板管理

### 2.1 科目分类（预设）
| 科目 | 图标 | 颜色 |
|------|------|------|
| 语文 | 📖 | #4A90D9 蓝色 |
| 数学 | 🔢 | #5CB85C 绿色 |
| 英语 | 🔤 | #F0AD4E 橙色 |
| 物理 | ⚛️ | #9B59B6 紫色 |
| 化学 | 🧪 | #E74C3C 红色 |
| 生物 | 🌱 | #27AE60 深绿 |
| 地理 | 🌍 | #3498DB 天蓝 |
| 历史 | 📜 | #8B4513 棕色 |
| 道法 | ⚖️ | #E91E63 粉色 |
| 科学 | 🔬 | #00BCD4 青色 |
| 运动 | 🏃 | #FF5722 橙红 |
| 技能 | 💡 | #607D8B 灰蓝 |
| 见识 | 🌐 | #795548 咖啡 |
| 自定义 | ➕ | 用户选择 |

### 2.2 任务模板结构
```typescript
interface TaskTemplate {
  id: string;
  subjectId: string;      // 所属科目
  name: string;           // 任务名称，如"练字"
  description: string;    // 任务说明
  defaultDuration: number; // 默认时长(分钟)
  hasReward: boolean;     // 是否奖励积分
  showSummary: boolean;   // 结束后弹出学习总结
  createdAt: Date;
  updatedAt: Date;
}
```

### 2.3 模板管理功能
- ➕ 添加新任务模板
- ✏️ 编辑任务模板
- 🗑️ 删除任务模板
- 📋 复制任务模板
- 🔄 重新排序（拖拽）

---

## 三、学习计划

### 3.1 添加计划表单
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| 任务分类 | 下拉选择 | ✅ | 选择科目 |
| 任务名称 | 输入/选择 | ✅ | 可从模板选择或新建 |
| 任务说明 | 文本框 | ❌ | 详细描述 |
| 计划时间 | 时间选择器 | ❌ | 开始-结束时间 |
| 计划用时 | **滑块** | ❌ | 拖动设置5-120分钟 |
| 到时自动完成 | 开关 | ❌ | 达到计划时长自动标记完成 |
| 重复频率 | 下拉选择 | ✅ | 仅当天/每天/工作日/周末/自定义 |
| 起始日期 | 日期选择 | ✅ | 开始日期-结束日期 |
| 积分奖惩 | 开关 | ❌ | 完成+积分，未完成-积分 |
| 学习总结 | 开关 | ❌ | 结束后弹出总结弹窗 |

### 3.2 时间滑块组件设计
```
计划用时（分钟）
[===●================] 30分钟

刻度: 5 | 10 | 15 | 30 | 45 | 60 | 90 | 120

特性:
- 拖拽滑块设置时长
- 点击刻度快速选择
- 显示当前选择值
- 支持触摸操作
```

### 3.3 重复频率选项
| 选项 | 说明 |
|------|------|
| 仅当天 | 只在选择的日期执行 |
| 每天 | 日期范围内每天执行 |
| 工作日 | 周一至周五 |
| 周末 | 周六、周日 |
| 自定义 | 勾选周一~周日 |

### 3.4 批量添加
**输入格式：**
```
语文作业（科目单独占一行）
1、完成《大青树下的小学》阅读单（一项作业占一行）
2、预习《花的学校》
数学作业（其他科目再另起一行）
1、完成练习册第10页
2、预习下一节
```

**解析规则：**
1. 识别科目关键词（语文、数学、英语等）
2. 数字开头的行作为任务项
3. 关联到对应科目
4. 未来功能：OCR拍照识别

---

## 四、打卡功能

### 4.1 打卡卡片显示
```
┌─────────────────────────────────────────┐
│ [语文图标] 练字  +1  [已总结] [仅当天] │
│ 内容: 每天练习一页字，注意笔画和结构    │
│ 实际时间: 16:07-16:08                   │
├─────────────────────────────────────────┤
│                              00:00:14   │
│                              [计时完成] │
└─────────────────────────────────────────┘
```

### 4.2 打卡状态
| 状态 | 颜色 | 说明 |
|------|------|------|
| 未开始 | 灰色 | 还没开始计时 |
| 进行中 | 蓝色 | 正在计时 |
| 已完成 | 绿色 | 完成打卡 |
| 逾期完成 | 橙色 | 超过计划时间完成 |
| 未完成 | 红色 | 当天未完成 |
| 自动完成 | 紫色 | 到时自动标记 |
| 手动完成 | 青色 | 手动标记完成 |

### 4.3 计时器功能
- ▶️ 开始计时
- ⏸️ 暂停计时
- ⏹️ 结束计时（标记完成）
- 🔄 重置计时
- 📝 手动完成（不计时）

### 4.4 完成后操作
1. 记录实际用时
2. 计算积分（如开启）
3. 显示学习总结弹窗（如开启）
4. 更新统计数据
5. 检查勋章解锁条件

---

## 五、统计分析

### 5.1 顶部快速统计栏
| 指标 | 说明 |
|------|------|
| 今日学习时间 | 累计打卡时长 |
| 运动/户外时间 | 运动类任务时长 |
| 今日任务数量 | 已完成/总数 |
| 今日完成进度 | 百分比 |
| 统计图表汇总 | 点击进入详情 |
| 荣誉勋章展示 | 点击进入勋章墙 |
| 成绩追踪统计 | 点击进入成绩页 |
| 积分奖励兑换 | 显示当前积分 |

### 5.2 图表类型

#### 5.2.1 每日计划完成情况（柱状图）
- X轴: 日期
- Y轴: 任务数量
- 双柱: 计划数量 vs 完成数量

#### 5.2.2 学习时间对比（折线图）
- X轴: 日期
- Y轴: 小时数
- 三线: 学习时间 / 运动时间 / 娱乐时间

#### 5.2.3 各分类用时占比（饼图）
- 显示各科目时间占比
- 点击可查看详情

#### 5.2.4 各分类每日用时对比（堆叠柱状图）
- X轴: 日期
- Y轴: 时长
- 按科目颜色堆叠

#### 5.2.5 计划用时 vs 实际用时（水平条形图）
- 对比每个任务的计划与实际用时
- 发现时间估算偏差

#### 5.2.6 任务完成类型分布（柱状图）
- 分类: 未开始/未完成/逾期完成/正常完成/自动完成/手动完成
- 了解完成习惯

### 5.3 筛选功能
- 日期范围选择
- 科目筛选
- 小孩筛选（家长模式）

### 5.4 创新指标

#### 学习专注度评分 (0-100)
```
计算公式:
专注度 = (有效学习时长 / 总学习时长) × 完成率 × 100

有效学习时长: 连续学习超过10分钟的时间
```

#### 习惯稳定性评分 (0-100)
```
计算公式:
稳定性 = 100 - (每日完成率标准差 × 10)

标准差越小，稳定性越高
```

#### 学科均衡度 (0-100)
```
计算公式:
均衡度 = 100 - (各科目时间标准差 / 平均时间 × 50)

各科目时间越接近，均衡度越高
```

---

## 六、勋章系统

### 6.1 勋章数据结构
```typescript
interface Achievement {
  id: string;
  name: string;           // 勋章名称
  description: string;    // 描述/解锁条件说明
  icon: string;           // 图标类型
  color: string;          // 颜色
  condition: {
    type: string;         // 条件类型
    value: number;        // 条件值
  };
  unlockedAt?: Date;      // 解锁时间
  isUnlocked: boolean;
}
```

### 6.2 解锁条件类型
| 条件类型 | 说明 | 示例 |
|----------|------|------|
| total_study_hours | 总学习时间达到(小时) | 10, 50, 100 |
| consecutive_days | 连续打卡天数 | 7, 30, 100 |
| total_tasks | 累计完成任务数 | 50, 200, 1000 |
| perfect_days | 100%完成天数 | 7, 30 |
| early_bird | 早起打卡次数(7点前) | 10, 30 |
| subject_hours | 单科累计时间(小时) | 20 |
| score_improve | 成绩提升(分) | 10, 20 |
| total_points | 累计获得积分 | 500, 2000 |

### 6.3 预设勋章列表
见 `00-项目总览.md` 中的勋章创意设计

### 6.4 勋章墙展示
- 已解锁: 彩色显示，带解锁日期
- 未解锁: 灰色显示，带进度提示
- 点击查看详情

---

## 七、积分奖励系统

### 7.1 积分获取规则
| 行为 | 积分 | 说明 |
|------|------|------|
| 完成任务 | +5~20 | 根据任务时长 |
| 连续打卡 | +10 | 每天额外奖励 |
| 提前完成 | +5 | 在计划时间前完成 |
| 100%完成 | +20 | 当天所有任务完成 |
| 解锁勋章 | +50 | 每个勋章一次 |

### 7.2 积分扣除规则
| 行为 | 积分 | 说明 |
|------|------|------|
| 任务未完成 | -5 | 当天未完成的任务 |
| 断签 | -10 | 连续打卡中断 |

### 7.3 奖励池管理（家长端）
- 添加奖励
- 编辑奖励
- 删除奖励
- 设置库存（可选）
- 查看兑换记录

### 7.4 兑换流程
1. 小孩浏览奖励池
2. 选择想要的奖励
3. 确认兑换（扣除积分）
4. 生成兑换记录
5. 家长收到通知（未来功能）
6. 家长确认已兑现

---

## 八、成绩追踪

### 8.1 成绩录入字段
| 字段 | 必填 | 说明 |
|------|------|------|
| 学年 | ✅ | 如: 2025 |
| 年级 | ✅ | 一年级~六年级 |
| 学期 | ✅ | 上学期/下学期 |
| 考试日期 | ✅ | 日期选择 |
| 考试名称 | ✅ | 如: 第一单元测试 |
| 考试类型 | ✅ | 单元测/期中/期末/模拟 |
| 科目 | ✅ | 下拉选择 |
| 总分 | ❌ | 满分，如100 |
| 得分 | ✅ | 实际分数 |
| 目标分 | ❌ | 期望分数 |
| 平均分 | ❌ | 班级平均分 |
| 最高分 | ❌ | 班级最高分 |
| 中位数 | ❌ | 班级中位数 |
| 考试表现 | ❌ | 优秀/良好/一般/需努力 |
| 排名类型 | ❌ | 班级/年级 |
| 名次 | ❌ | 排名数字 |

### 8.2 薄弱总结
| 字段 | 说明 |
|------|------|
| 题型 | 选择题/填空题/应用题等 |
| 知识点 | 具体知识点 |
| 分值 | 该题分值 |
| 得分 | 实际得分 |
| 丢分率 | 自动计算 |
| 总结 | 文字描述 |

### 8.3 成绩分析图表
- 单科成绩趋势（折线图）
- 各科成绩对比（雷达图）
- 与班级对比（柱状图）
- 进步/退步标识

---

## 九、PDF学习报告

### 9.1 报告内容
1. **封面**
   - 标题: XX的学习报告
   - 时间范围
   - 生成日期

2. **学习概览**
   - 总学习时长
   - 完成任务数
   - 平均完成率
   - 连续打卡天数

3. **时间分布**
   - 各科目时间占比饼图
   - 每日学习时长折线图

4. **任务完成情况**
   - 完成率趋势
   - 任务类型分布

5. **成绩追踪**
   - 各科成绩趋势
   - 进步/退步标识

6. **获得成就**
   - 已解锁勋章列表

7. **家长寄语**
   - 可选填写

### 9.2 导出选项
- 时间范围: 本周/本月/本学期/自定义
- 包含内容: 勾选需要的模块
- 文件格式: PDF

---

## 十、数据同步

### 10.1 同步触发
- 手动点击同步按钮
- 登录时自动同步
- 切换设备时同步

### 10.2 同步状态显示
| 状态 | 图标 | 说明 |
|------|------|------|
| 已同步 | ✅ | 数据已是最新 |
| 有更改 | 🔄 | 本地有未同步的更改 |
| 同步中 | ⏳ | 正在同步 |
| 同步失败 | ❌ | 同步出错，点击重试 |
| 离线 | 📴 | 无网络连接 |

### 10.3 冲突处理
- 默认: 最新时间戳优先
- 可选: 提示用户选择

### 10.4 数据保留
- 本地: 无限期（IndexedDB）
- 服务器: 6年
- 支持数据导出备份

---

## 十一、移动端适配

### 11.1 响应式断点
| 断点 | 宽度 | 设备 |
|------|------|------|
| sm | <640px | 手机 |
| md | 640-768px | 大手机/小平板 |
| lg | 768-1024px | 平板 |
| xl | >1024px | 桌面 |

### 11.2 移动端特殊处理
- 侧边栏改为底部导航
- 表单全屏弹窗
- 大按钮（最小44px）
- 滑动手势支持
- 下拉刷新

### 11.3 PWA特性
- 添加到主屏幕
- 离线使用
- 启动画面
- 推送通知（未来）

